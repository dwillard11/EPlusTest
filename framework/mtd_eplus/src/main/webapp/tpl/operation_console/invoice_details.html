<div class="wrapper-md" ng-controller="invoicedetailsctrl">
    <div class="bg-light lter b-b wrapper-md">
        <div class="row">
            <div class="col-sm-6 col-xs-12">
                <h1 class="m-n font-thin h3">Invoice Builder</h1>
            </div>
        </div>
    </div>
    <div class="panel panel-default">
        <div class="panel-body">
            <form name="invoiceform" class="form-horizontal">
                <div class="col-lg-4">
                    <div class="form-group">
                        <label class="col-sm-4 control-label text-left">Invoice #</label>
                        <div class="col-sm-8">
                            <p class="form-control-static">{{invoice.refNum}}</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="form-group">
                        <label class="col-sm-4 control-label text-left">Trip Type</label>
                        <div class="col-sm-8">
                            <p class="form-control-static">{{invoice.serviceType}}</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="form-group">
                        <label class="col-sm-4 control-label text-left">Invoice Date</label>
                        <div class="col-sm-8">
                            <div class="dropdown">
                                <a class="dropdown-toggle" id="dropdown2" role="button"

                                   data-toggle="dropdown" data-target="#">
                                    <div class="input-group"><input type="text" class="form-control"
                                                                    data-ng-model="invoice.invoiceDate"
                                                                    id="invoiceDate" ng-disabled="disableFlag"><span
                                            class="input-group-addon"><i
                                            class="glyphicon glyphicon-calendar"></i></span>
                                    </div>
                                </a>
                                <ul class="dropdown-menu pull-right" role="menu" aria-labelledby="dLabel">
                                    <datetimepicker data-ng-model="invoice.invoiceDate"

                                                    data-datetimepicker-config="{ dropdownSelector: '#dropdown2', startView: 'day',minView: 'day', modelType: 'YYYY-MM-DD'}"/>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group">
                        <label class="col-sm-1 control-label text-left">Trip From</label>
                        <div class="col-sm-3">
                            <input type="text" ng-model="invoice.invoiceFrom" value="{{invoice.invoiceFrom}}"
                                   class="form-control"
                                   style="width: 920px !important; min-width: 400px; max-width: 920px;"
                                   ng-disabled="disableFlag">
                        </div>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group">
                        <label class="col-sm-1 control-label text-left">Trip To</label>
                        <div class="col-sm-3">
                            <input type="text" ng-model="invoice.invoiceTo" value="{{invoice.invoiceTo}}"
                                   class="form-control" ng-disabled="disableFlag"
                                   style="width: 920px !important; min-width: 400px; max-width: 920px;">
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="form-group">
                        <label class="col-sm-2 control-label text-left">Pickup Date</label>
                        <div class="col-sm-6">
                            <div class="dropdown">
                                <a class="dropdown-toggle" id="dropdown3" role="button"

                                   data-toggle="dropdown" data-target="#">
                                    <div class="input-group"><input type="text" class="form-control"
                                                                    data-ng-model="invoice.pickupDate"
                                                                    id="pickupDate" ng-disabled="disableFlag"><span
                                            class="input-group-addon"><i
                                            class="glyphicon glyphicon-calendar"></i></span>
                                    </div>
                                </a>
                                <ul class="dropdown-menu pull-right" role="menu" aria-labelledby="dLabel">
                                    <datetimepicker data-ng-model="invoice.pickupDate"
                                                    data-datetimepicker-config="{ dropdownSelector: '#dropdown3', startView: 'day',minView: 'day', modelType: 'YYYY-MM-DD'}"/>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="form-group">
                        <label class="col-sm-2 control-label text-left">Delivery Date</label>
                        <div class="col-sm-6">
                            <div class="dropdown">
                                <a class="dropdown-toggle" id="dropdown4" role="button"

                                   data-toggle="dropdown" data-target="#">
                                    <div class="input-group"><input type="text" class="form-control"
                                                                    data-ng-model="invoice.deliveryDate"
                                                                    id="deliveryDate" ng-disabled="disableFlag"><span
                                            class="input-group-addon"><i
                                            class="glyphicon glyphicon-calendar"></i></span>
                                    </div>
                                </a>
                                <ul class="dropdown-menu pull-right" role="menu" aria-labelledby="dLabel">
                                    <datetimepicker data-ng-model="invoice.deliveryDate"

                                                    data-datetimepicker-config="{ dropdownSelector: '#dropdown4', startView: 'day',minView: 'day', modelType: 'YYYY-MM-DD'}"/>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="form-group">
                        <label class="col-sm-2 control-label text-left">Auth By</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control" ng-model="invoice.authBy" ng-disabled="disableFlag"
                                   value="{{invoice.authBy}}">
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="form-group">
                        <label class="col-sm-2 control-label text-left">Auth NO</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control" ng-model="invoice.authNo" ng-disabled="disableFlag"
                                   value="{{invoice.authNo}}">
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="form-group">
                        <label class="col-sm-2 control-label text-left">Miles</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control" ng-model="invoice.miles" ng-disabled="disableFlag"
                                   ng-keyup="clearNoNum(invoice,'miles')">
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="form-group">
                        <label class="col-sm-2 control-label text-left">Rate</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control" ng-model="invoice.rate" ng-disabled="disableFlag"
                                   ng-keyup="clearNoNum(invoice,'rate')">
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="form-group">
                        <label class="col-sm-4 control-label text-left">Pieces</label>
                        <div class="col-sm-8">
                            <p class="form-control-static">{{invoice.totalPieces}}</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="form-group">
                        <label class="col-sm-4 control-label text-left">Actual Weight</label>
                        <div class="col-sm-8">
                            <p class="form-control-static">{{invoice.actualWeightWithUOM}}</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="form-group">
                        <label class="col-sm-4 control-label text-left">Chargeable Weight</label>
                        <div class="col-sm-8">
                            <p class="form-control-static">{{invoice.chargeableWeightWithUOM}}</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group">
                        <label class="col-sm-1 control-label text-left">Pickup At</label>
                        <div class="col-sm-3">
                            <input type="text" ng-model="temp.pickupAt" value="{{temp.pickupAt}}"
                                   ng-disabled="disableFlag" class="form-control"
                                   style="width: 920px !important; min-width: 400px; max-width: 920px;">
                        </div>
                    </div>
                </div>
            </form>
            <div class="row">
                <div class="col-lg-6">
                    <div class="panel panel-default">
                        <div class="panel-heading font-bold">Invoice To</div>
                        <div class="panel-body">
                            <form class="form-horizontal" method="post">
                                <div class="hidden form-group">
                                    <div class="col-sm-11">
                                        <input class="form-control" type="text"
                                               ng-model="billedClient.id" disabled>
                                    </div>
                                </div>


                                <div class="form-group">
                                    <label class="col-sm-2 control-label">Search</label>
                                    <div class="col-sm-9">
                                        <div class="input-group">
                                            <ui-select ng-model="billedClient.selected" theme="bootstrap"
                                                       ng-disabled="disableFlag"
                                                       ng-change="selectLocation(billedClient.selected,'billedClient')">
                                                <ui-select-match
                                                        placeholder="Select or search a client in the list...">
                                                    {{$select.selected.genericInfo}}
                                                </ui-select-match>
                                                <ui-select-choices group-by="'customerName'"
                                                                   repeat="item in clients "
                                                                   refresh="searchLocation($select.search)"
                                                                   refresh-delay="400">
                                                    <span ng-bind-html="item.genericInfo | highlight: $select.search"></span>
                                                </ui-select-choices>
                                            </ui-select>
                                            <span class="input-group-btn">
                                                              <a ng-click="selectLocation({},'billedClient');"
                                                                 ng-disabled="disableFlag"
                                                                 class="btn btn-default">
                                                                <span class="fa fa-close"></span>
                                                              </a>
                                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label text-right">Name</label>
                                    <div class="col-sm-9">
                                        <div class="input-group">
                                            <input class="form-control" type="text"
                                                   ng-model="billedClient.customerName" disabled />
                                            <span class="input-group-btn">
                                                        <button class="btn btn-default" type="button" ng-click="showEntity(billedClient)" ng-disabled="!billedClient || !billedClient.id">
                                                            <span class="glyphicon glyphicon-eye-open"></span>
                                                        </button>
                                                    </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label text-right">Address</label>
                                    <div class="col-sm-9">
                                        <input class="form-control" type="text"
                                               ng-model="billedClient.address1"
                                               disabled>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label text-right">Postal</label>
                                    <div class="col-sm-9">
                                        <input class="form-control" type="text"
                                               ng-model="billedClient.postalCode"
                                               disabled>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label text-right">City</label>
                                    <div class="col-sm-3">
                                        <input class="form-control" type="text"
                                               ng-model="billedClient.city"
                                               disabled>
                                    </div>

                                    <div class="col-sm-1"></div>

                                    <label class="col-sm-2 control-label text-right">Province</label>
                                    <div class="col-sm-3">
                                        <input class="form-control" type="text"
                                               ng-model="billedClient.stateProvince"
                                               disabled>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label text-right">Country</label>
                                    <div class="col-sm-3">
                                        <input class="form-control" type="text"
                                               ng-model="billedClient.country"
                                               disabled>
                                    </div>

                                    <div class="col-sm-1"></div>

                                    <label class="col-sm-2 control-label text-right">Phone #</label>
                                    <div class="col-sm-3">
                                        <input class="form-control" type="text"
                                               ng-model="billedClient.busPhone1"
                                               disabled>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label text-right">Notes</label>
                                    <div class="col-sm-9">
                                                <textarea class="form-control" rows="6"
                                                          ng-model="billedClient.notes"
                                                          disabled></textarea>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="panel panel-default">
                        <div class="panel-heading font-bold">Shipper</div>
                        <div class="panel-body">
                            <form class="form-horizontal" method="post">
                                <div class="hidden form-group">
                                    <div class="col-sm-11">
                                        <input class="form-control" type="text"
                                               ng-model="shipper.id" disabled>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label">Search</label>
                                    <div class="col-sm-9">
                                        <div class="input-group">
                                            <ui-select ng-model="shipper.selected" theme="bootstrap"
                                                       ng-disabled="disableFlag"
                                                       ng-change="selectLocation(shipper.selected,'shipper')">
                                                <ui-select-match
                                                        placeholder="Select or search a client in the list...">
                                                    {{$select.selected.genericInfo}}
                                                </ui-select-match>
                                                <ui-select-choices group-by="'customerName'"
                                                                   repeat="item in clients "
                                                                   refresh="searchLocation($select.search)"
                                                                   refresh-delay="400">
                                                    <span ng-bind-html="item.genericInfo | highlight: $select.search"></span>
                                                </ui-select-choices>
                                            </ui-select>
                                            <span class="input-group-btn">
                                                              <a ng-click="selectLocation({},'shipper');"
                                                                 ng-disabled="disableFlag"
                                                                 class="btn btn-default">
                                                                <span class="fa fa-close"></span>
                                                              </a>
                                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label text-right">Name</label>
                                    <div class="col-sm-9">
                                        <div class="input-group">
                                            <input class="form-control" type="text"
                                                   ng-model="shipper.customerName" disabled />
                                            <span class="input-group-btn">
                                                        <button class="btn btn-default" type="button" ng-click="showEntity(shipper)" ng-disabled="!shipper || !shipper.id">
                                                            <span class="glyphicon glyphicon-eye-open"></span>
                                                        </button>
                                                    </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label text-right">Address</label>
                                    <div class="col-sm-9">
                                        <input class="form-control" type="text"
                                               ng-model="shipper.address1"
                                               disabled>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label text-right">Postal</label>
                                    <div class="col-sm-9">
                                        <input class="form-control" type="text"
                                               ng-model="shipper.postalCode"
                                               disabled>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label text-right">City</label>
                                    <div class="col-sm-3">
                                        <input class="form-control" type="text"
                                               ng-model="shipper.city"
                                               disabled>
                                    </div>

                                    <div class="col-sm-1"></div>

                                    <label class="col-sm-2 control-label text-right">Province</label>
                                    <div class="col-sm-3">
                                        <input class="form-control" type="text"
                                               ng-model="shipper.stateProvince"
                                               disabled>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label text-right">Country</label>
                                    <div class="col-sm-3">
                                        <input class="form-control" type="text"
                                               ng-model="shipper.country"
                                               disabled>
                                    </div>

                                    <div class="col-sm-1"></div>

                                    <label class="col-sm-2 control-label text-right">Phone #</label>
                                    <div class="col-sm-3">
                                        <input class="form-control" type="text"
                                               ng-model="shipper.busPhone1"
                                               disabled>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label text-right">Notes</label>
                                    <div class="col-sm-9">
                                                <textarea class="form-control" rows="6"
                                                          ng-model="shipper.notes"
                                                          disabled></textarea>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="row wrapper">
                            <div class="col-sm-8">
                                <div class="input-group col-sm-8 m-t-xs">
                                    <label class="col-sm-3 control-label m-t-xs">Billing Currency:</label>
                                    <div class="col-sm-2">
                                        <select class="form-control"
                                                ng-options="Option.id as Option.name for Option in currencyOption"
                                                ng-model="invoice.billingCurrency" required="required"  ng-disabled="disableFlag || keepCurrency"
                                                ng-change="calculateSummary(invoice.billingCurrency, invoice.details)">
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="btn-group  pull-right m-t-xs">
                                    <span>
                                              <script type="text/ng-template" id="invoiceitem.html">
                                                <div ng-include="'tpl/operation_console/invoice_item_form.html'"></div>
                                              </script>
                                                <button class="btn btn-success" ng-show="!disableFlag"
                                                        ng-click="editDetails(invoice.id, '', 'add')">Add</button>
                                            </span>
                                </div>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table st-table="displayedCollection" st-safe-src="invoice.details"
                                   class="table table-striped">
                                <thead>
                                <tr>
                                    <th class="hidden" st-sort="id">id</th>
                                    <th st-sort="item">Charge Description</th>
                                    <th st-sort="amount">Charge</th>
                                    <th st-sort="taxCode">Tax</th>
                                    <th st-sort="taxAmount">Tax Amount</th>
                                    <th st-sort="total">Total</th>
                                    <th style="width: 60px; text-align: center">Action</th>
                                </tr>
                                </thead>
                                <tbody ng-show="!isLoading">
                                <tr ng-repeat="row in displayedCollection">
                                    <td class="hidden">{{row.id}}</td>
                                    <td>{{row.item}}</td>
                                    <td>{{row.amount | currency:'':2}}</td>
                                    <td>{{row.taxCode }}</td>
                                    <td>{{row.taxAmount | currency:'':2}}</td>
                                    <td>{{row.total | currency:'':2}}</td>
                                    <td style="white-space: nowrap">
                                        <div class="buttons" ng-show="!disableFlag">
                                            <button class="btn btn-sm btn-info"
                                                    ng-click="editDetails(invoice.id, row, 'edit')"
                                                    tooltip-placement="bottom"
                                                    tooltip="Edit">
                                                <i class="fa fa-edit"></i>
                                            </button>
                                            <button class="btn btn-sm btn-danger"
                                                    ng-click="removeItem(row)"
                                                    tooltip-placement="bottom"
                                                    tooltip="Delete"><i
                                                    class="fa fa-times"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                                <tbody ng-show="isLoading">
                                <tr>
                                    <td colspan="7" class="text-center"><i
                                            class="fa fa-spin fa-refresh"></i></td>
                                </tr>
                                </tbody>

                                <tfoot>

                                <tr>
                                    <td class="hidden">

                                    </td>

                                    <td>
                                        <table>
                                            <tr>
                                                <td width="100">USD Rate</td>
                                                <td width="80" align="left">{{usdRate}}</td>
                                            </tr>
                                            <tr>
                                                <td width="100">Total in USD</td>
                                                <td width="80" align="left">{{totalInUSD | currency:'':2}}</td>
                                            </tr>
                                        </table>
                                    </td>

                                    <td>

                                    </td>

                                    <td>

                                    </td>

                                    <td>

                                    </td>

                                    <td colspan="3" align="right">
                                        <table>
                                            <tr>
                                                <td width="100" align="right">Subtotal</td>
                                                <td width="80" align="right"> {{subtotal | currency:'':2}}</td>
                                            </tr>
                                        </table>
                                        <table>
                                            <tr ng-repeat="(key,value) in taxs">
                                                <td width="100" align="right">{{key}}</td>
                                                <td width="80" align="right"> {{value | currency:'':2}}</td>
                                            </tr>
                                        </table>
                                        <table>
                                            <tr>
                                                <td width="100" align="right">Total</td>
                                                <td width="80" align="right"> {{totalAmount | currency:'':2}}</td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2" class="text-left">
                                        <div>
                                            <small class="text-muted inline m-t-sm m-b-sm">Total item(s):
                                                {{invoice.details.length}}
                                            </small>
                                        </div>
                                    </td>
                                    <td colspan="5" class="text-center">
                                        <div st-template="pagination.html" st-pagination="" st-items-by-page="itemsByPage"></div>
                                    </td>
                                </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="col-lg-12">
                    <div class="btn-group  pull-right m-t-xs">
                        <button class="btn btn-danger " type="button"
                                ng-click="back()">Cancel
                        </button>
                    </div>
                    <div class="btn-group  pull-right m-t-xs">
                        <button class="btn btn-success " type="button" ng-show="!disableFlag"
                                ng-click="saveInvoice()">Save
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>